(function(f){function l(d){if(!(this instanceof l))return new l(d);this.b=this.a="";this.S=[this.a,this.b];this.L=f.MAX_BUFFER_LENGTH;this.q=this.s="";this.O=d||{};this.closed=!1;this.error=null;this.state=a.u;this.stack=new p;this.position=this.r=0;this.M=1;this.P=!1;this.Q=0;this.l=null;k(this,"onready")}function h(a){if(!(this instanceof h))return new h(a);this.d=new l(a);this.writable=!0;this.e=this.g=0;this.t={2:new Buffer(2),3:new Buffer(3),4:new Buffer(4)};this.h="";var c=this;q.apply(c);this.d.Z=
function(){c.i("end")};this.d.onerror=function(b){c.i("error",b);c.d.error=null};t.forEach(function(b){Object.defineProperty(c,"on"+b,{get:function(){return c.d["on"+b]},set:function(a){if(!a)return c.$(b),c.d["on"+b]=a;c.N(b,a)},enumerable:!0,configurable:!1})})}function k(a,c,b){f.INFO&&console.log("-- emit",c,b);if(a[c])a[c](b)}function n(a,c){var b=a.O,e=a.a;b.trim&&(e=e.trim());b.normalize&&(e=e.replace(/\s+/g," "));a.a=e;a.a&&k(a,c?c:"onvalue",a.a);a.a=""}function g(a,c){n(a);c+="\nLine: "+
a.M+"\nColumn: "+a.r+"\nChar: "+a.q;c=Error(c);a.error=c;k(a,"onerror",c);return a}function u(d){d.state!==a.c&&g(d,"Unexpected end");n(d);d.q="";d.closed=!0;k(d,"onend");l.call(d,d.O);return d}var r,p;r="object"===typeof process&&process.T?process.T:window;if("function"===typeof FastList)p=FastList;else if("function"===typeof require)try{p=require("fast-list")}catch(x){p=Array}else p=Array;f.parser=function(a){return new l(a)};f.CParser=l;f.CStream=h;f.createStream=function(a){return new h(a)};f.MAX_BUFFER_LENGTH=
65536;f.DEBUG="debug"===r.v;f.INFO="debug"===r.v||"info"===r.v;f.EVENTS="value string key openobject closeobject openarray closearray error end ready".split(" ");var t=f.EVENTS.filter(function(a){return"error"!==a&&"end"!==a}),a=0,q;f.STATE={u:a++,c:a++,o:a++,f:a++,k:a++,m:a++,Y:a++,p:a++,V:a++,W:a++,n:a++,w:a++,I:a++,J:a++,K:a++,A:a++,B:a++,C:a++,D:a++,F:a++,G:a++,H:a++,R:a++,j:a++};for(var v in f.STATE)f.STATE[f.STATE[v]]=v;a=f.STATE;Object.create||(Object.create=function(a){function c(){this.__proto__=
a}c.prototype=a;return new c});Object.getPrototypeOf||(Object.getPrototypeOf=function(a){return a.__proto__});Object.keys||(Object.keys=function(a){var c=[],b;for(b in a)a.hasOwnProperty(b)&&c.push(b);return c});var w=/[\\"\n]/g;l.prototype={end:function(){u(this)},write:function(d){if(this.error)throw this.error;if(this.closed)return g(this,"Cannot write after close. Assign an onready handler.");if(null===d)return u(this);var c=0,b=d[0],e=this.s;for(f.DEBUG&&console.log("write -> ["+d+"]");b;){e=
b;this.q=b=d.charAt(c++);e!==b?this.s=e:e=this.s;if(!b)break;f.DEBUG&&console.log(c,b,f.STATE[this.state]);this.position++;"\n"===b?(this.M++,this.r=0):this.r++;switch(this.state){case a.u:"{"===b?this.state=a.o:"["===b?this.state=a.k:"\r"!==b&&"\n"!==b&&" "!==b&&"\t"!==b&&g(this,"Non-whitespace before {[.");continue;case a.n:case a.o:if("\r"===b||"\n"===b||" "===b||"\t"===b)continue;if(this.state===a.n)this.stack.push(a.w);else if("}"===b){k(this,"onopenobject");k(this,"oncloseobject");this.state=
this.stack.pop()||a.c;continue}else this.stack.push(a.f);'"'===b?this.state=a.p:g(this,'Malformed object key should start with "');continue;case a.w:case a.f:if("\r"===b||"\n"===b||" "===b||"\t"===b)continue;":"===b?(this.state===a.f?(this.stack.push(a.f),n(this,"onopenobject")):n(this,"onkey"),this.state=a.c):"}"===b?(n(this),k(this,"oncloseobject",void 0),this.state=this.stack.pop()||a.c):","===b?(this.state===a.f&&this.stack.push(a.f),n(this),this.state=a.n):g(this,"Bad object");continue;case a.k:case a.c:if("\r"===
b||"\n"===b||" "===b||"\t"===b)continue;if(this.state===a.k)if(k(this,"onopenarray"),this.state=a.c,"]"===b){k(this,"onclosearray");this.state=this.stack.pop()||a.c;continue}else this.stack.push(a.m);'"'===b?this.state=a.p:"{"===b?this.state=a.o:"["===b?this.state=a.k:"t"===b?this.state=a.I:"f"===b?this.state=a.A:"n"===b?this.state=a.F:"-"===b?this.b+=b:"0"===b?(this.b+=b,this.state=a.j):-1!=="123456789".indexOf(b)?(this.b+=b,this.state=a.j):g(this,"Bad value");continue;case a.m:if(","===b)this.stack.push(a.m),
n(this,"onvalue"),this.state=a.c;else if("]"===b)n(this),k(this,"onclosearray",void 0),this.state=this.stack.pop()||a.c;else if("\r"===b||"\n"===b||" "===b||"\t"===b)continue;else g(this,"Bad array");continue;case a.p:var e=c-1,h=this.P,m=this.Q;a:for(;;){for(f.DEBUG&&console.log(c,b,f.STATE[this.state],h);0<m;)if(this.l+=b,b=d.charAt(c++),4===m?(this.a+=String.fromCharCode(parseInt(this.l,16)),m=0,e=c-1):m++,!b)break a;if('"'===b&&!h){this.state=this.stack.pop()||a.c;(this.a+=d.substring(e,c-1))||
k(this,"onvalue","");break}if("\\"===b&&!h&&(h=!0,this.a+=d.substring(e,c-1),b=d.charAt(c++),!b))break;if(h)if(h=!1,"n"===b?this.a+="\n":"r"===b?this.a+="\r":"t"===b?this.a+="\t":"f"===b?this.a+="\f":"b"===b?this.a+="\b":"u"===b?(m=1,this.l=""):this.a+=b,b=d.charAt(c++),e=c-1,b)continue;else break;w.lastIndex=c;var l=w.exec(d);if(null===l){c=d.length+1;this.a+=d.substring(e,c-1);break}c=l.index+1;b=d.charAt(l.index);if(!b){this.a+=d.substring(e,c-1);break}}this.P=h;this.Q=m;continue;case a.I:if(""===
b)continue;"r"===b?this.state=a.J:g(this,"Invalid true started with t"+b);continue;case a.J:if(""===b)continue;"u"===b?this.state=a.K:g(this,"Invalid true started with tr"+b);continue;case a.K:if(""===b)continue;"e"===b?(k(this,"onvalue",!0),this.state=this.stack.pop()||a.c):g(this,"Invalid true started with tru"+b);continue;case a.A:if(""===b)continue;"a"===b?this.state=a.B:g(this,"Invalid false started with f"+b);continue;case a.B:if(""===b)continue;"l"===b?this.state=a.C:g(this,"Invalid false started with fa"+
b);continue;case a.C:if(""===b)continue;"s"===b?this.state=a.D:g(this,"Invalid false started with fal"+b);continue;case a.D:if(""===b)continue;"e"===b?(k(this,"onvalue",!1),this.state=this.stack.pop()||a.c):g(this,"Invalid false started with fals"+b);continue;case a.F:if(""===b)continue;"u"===b?this.state=a.G:g(this,"Invalid null started with n"+b);continue;case a.G:if(""===b)continue;"l"===b?this.state=a.H:g(this,"Invalid null started with nu"+b);continue;case a.H:if(""===b)continue;"l"===b?(k(this,
"onvalue",null),this.state=this.stack.pop()||a.c):g(this,"Invalid null started with nul"+b);continue;case a.R:"."===b?(this.b+=b,this.state=a.j):g(this,"Leading zero not followed by .");continue;case a.j:-1!=="0123456789".indexOf(b)?this.b+=b:"."===b?(-1!==this.b.indexOf(".")&&g(this,"Invalid number has two dots"),this.b+=b):"e"===b||"E"===b?(-1===this.b.indexOf("e")&&-1===this.b.indexOf("E")||g(this,"Invalid number has two exponential"),this.b+=b):"+"===b||"-"===b?("e"!==e&&"E"!==e&&g(this,"Invalid symbol in number"),
this.b+=b):(this.b&&k(this,"onvalue",parseFloat(this.b)),this.b="",c--,this.state=this.stack.pop()||a.c);continue;default:g(this,"Unknown state: "+this.state)}}if(this.position>=this.L){d=Math.max(f.MAX_BUFFER_LENGTH,10);c=0;b=this.S;e=0;for(h=b.length;e<h;e++){m=b[e].length;if(m>d)switch(b[e]){case "text":closeText(this);break;default:g(this,"Max buffer length exceeded: "+b[e])}c=Math.max(c,m)}this.L=f.MAX_BUFFER_LENGTH-c+this.position}return this},U:function(){this.error=null;return this},close:function(){return this.write(null)}};
try{q=require("stream").X}catch(y){q=function(){}}h.prototype=Object.create(q.prototype,{constructor:{value:h}});h.prototype.write=function(a){a=new Buffer(a);for(var c=0;c<a.length;c++){var b=a[c];if(0<this.g){for(c=0;c<this.g;c++)this.t[this.e][this.e-this.g+c]=a[c];this.h=this.t[this.e].toString();this.e=this.g=0;this.d.write(this.h);this.i("data",this.h);return!0}if(0===this.g&&128<=b)if(194<=b&&223>=b&&(this.e=2),224<=b&&239>=b&&(this.e=3),240<=b&&244>=b&&(this.e=4),this.e+c>a.length){for(b=
0;b<=a.length-1-c;b++)this.t[this.e][b]=a[c+b];this.g=c+this.e-a.length;c=a.length-1}else return this.h=a.slice(c,c+this.e).toString(),this.d.write(this.h),this.i("data",this.h),!0;else return this.d.write(a.toString()),this.i("data",a),!0}};h.prototype.end=function(a){a&&a.length&&this.d.write(a.toString());this.d.end();return!0};h.prototype.N=function(a,c){var b=this;b.d["on"+a]||-1===t.indexOf(a)||(b.d["on"+a]=function(){var c=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);c.splice(0,
0,a);b.i.apply(b,c)});return q.prototype.N.call(b,a,c)}})("undefined"===typeof exports?clarinet={}:exports);var s=clarinet.parser();s.write("{hello");s.end();s.U();s.close();
